# Telegram-бот для расписания футбола

Telegram-бот, предоставляющий информацию о расписании футбольных матчей, турнирных таблицах и командах с использованием API Football Data. Бот контейнеризирован с помощью Docker и использует MongoDB для хранения данных, PostgreSQL для данных пользователей и Redis для кэширования. Отдельный сервис обновления периодически загружает и обновляет данные в фоновом режиме.

## Возможности
- Получение и отображение расписания футбольных матчей.
- Предоставление текущих турнирных таблиц различных лиг.
- Отображение информации о командах.
- Кэширование ответов с помощью Redis для повышения производительности.
- Периодическое обновление данных через отдельный сервис обновления.

## Требования
- Установленные Docker и Docker Compose.
- Настроенная WSL2 (Windows Subsystem for Linux), если используется Windows.
- Установленный Go (Golang) для локальной разработки (опционально).
- Ключ API от [Football Data API](https://api.football-data.org/).
- Работающие сервисы MongoDB, PostgreSQL и Redis (через Docker или локально).

## Настройка

### 1. Клонирование репозитория
```
git clone https://github.com/vsespontanno/tgbot_fschedule.git
cd tgbot_fschedule
```
### 2. Настройка переменных окружения

Создайте файл .env в корневой директории с следующими переменными:
```
# Токен Telegram-бота
TELEGRAM_TOKEN=ваш_токен_telegram_бота

# Ключ API Football Data
FOOTBALL_DATA_API_KEY=ваш_ключ_football_data_api

# MongoDB
MONGODB_URI=mongodb://mongo:27017

# PostgreSQL
PG_USER=ваш_пользователь_postgres
PG_PASSWORD=ваш_пароль_postgres
PG_DB=ваша_база_postgres
PG_HOST=postgres
PG_PORT=5432

# Redis
REDIS_URL=redis://redis:6379/0
```
-   Получите TELEGRAM_TOKEN, создав бота через [@BotFather](https://t.me/BotFather) в Telegram.
-   Замените ваш_ключ_football_data_api на действительный ключ от Football Data.
-   Настройте MONGODB_URI, PG_* и REDIS_URL в зависимости от вашего окружения (например, используйте localhost для локальных тестов вне Docker).

### 3. Сборка и запуск с Docker

Убедитесь, что Docker и Docker Compose установлены и настроены с WSL2 (если на Windows).

#### Запуск сервисов

```
docker-compose up --build   
```

-   Это запустит сервисы postgres, mongo, redis, bot и updater.
-   Бот будет доступен через Telegram, а сервис обновления будет периодически загружать данные.

#### Остановка сервисов

```
docker-compose down
```
### 4. Локальная разработка (опционально)

Для локального тестирования (например, запуска обновления):

-   Установите Go и зависимости
```
go mod tidy
```

-   Запустите обновление локально (настройте REDIS_URL и MONGODB_URI для локального доступа)

-   Примечание: Убедитесь, что Redis и MongoDB запущены локально или через Docker с открытыми портами.

## Архитектура

### Компоненты

-   **Бот**: Обрабатывает обновления Telegram и взаимодействие с пользователями (cmd/bot/main.go).
-   **Обновление**: Периодически загружает расписания матчей, таблицы и команды из Football Data API и сохраняет их в MongoDB (cmd/updater/main.go).
-   **Клиент API**: Взаимодействует с Football Data API для получения футбольных данных (internal/client/api).
-   **Сервисы**: Логика бизнеса для матчей, таблиц, команд и пользователей (internal/service).
-   **Репозитории**: Слои доступа к данным для MongoDB и PostgreSQL (internal/repository).
-   **Кэш**: Клиент Redis для кэширования ответов (internal/cache).

### Хранилище данных

-   **MongoDB**: Хранит расписания матчей, таблицы и команды (база football).
-   **PostgreSQL**: Хранит данные пользователей.
-   **Redis**: Кэширует ответы бота для повышения производительности.

### Планирование

-   Обновление использует github.com/go-co-op/gocron для планирования задач:
    -   Матчи: Каждые 24 часа (тестируется с интервалом 1 минута).
    -   Таблицы: Каждые 6 часов (тестируется с интервалом 1 минута).
    -   Команды: Каждые 300 дней (тестируется с интервалом 1 минута).

## Использование

-   Взаимодействуйте с ботом через Telegram с помощью команд или запросов обратного вызова.
-   Сервис обновления работает в фоновом режиме для поддержания актуальности данных.
-   Проверяйте логи на наличие ошибок или успешных обновлений:bash
``` 
docker-compose logs 'название контейнера' -f 
```

## Лицензия

Лицензия MIT (или укажите вашу предпочтительную лицензию).